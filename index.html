<!DOCTYPE html>
<html>
<head>
  <title>HS Hierarchy Example</title>
  <meta charset="UTF-8">
    <!-- jquery and friends -->
  <script src="../example-api-common/jquery-2.2.4.js"></script>
  <script src="../example-api-common/jquery-ui.js"></script>
  <link rel="stylesheet" type="text/css" href="../example-api-common/jquery-ui.css">
  <!-- look and feel -->
  <link rel="stylesheet" type="text/css" href="//ausftas.github.io/example-api-common/style.css">
  <link rel="stylesheet" type="text/css" href="http://blog.dfilimonov.com/github-ribbons-css/ribbons.css">
  <script src="//ausftas.github.io/example-api-common/style.js"></script>
  <!-- shared sources -->
  <script src="../example-api-common/common.js"></script>
</head>
<body>
  <div id="header"></div>
  
  <div id="example" class="content">
    <h1>API Hierarchy Example</h1>
    
    <div id="loading">
      Please wait while it loads.
    </div>
    
    <div id="hierarchy" style="display: none;" >
    
    </div>

    <script>
      
      $.startExample(function(hierarchy)
      {
        // helper functions
        function filterType(type_)
        {
          return function(hSCode)
          {
            return hierarchy[hSCode].type === type_;
          };
        }
        
        function filterChapter(chapterStart, chapterEnd)
        {
          return function(hSCode)
          {
            return hSCode >= chapterStart && hSCode <= chapterEnd;
          };
        }
        
        function filterHS(chapter)
        {
          return function(hSCode)
          {
            return hSCode.indexOf(chapter) === 0;
          };
        }
        
        function headingToHTML(headingHSCode)
        {
          var heading = hierarchy[headingHSCode];
          return '<li>' + 'Heading ' + headingHSCode + ' - ' + heading.description + '</li>';
        }
        
        function chapterToHTML(chapterHSCode)
        {
          var chapter = hierarchy[chapterHSCode];
          
          return '<p>' + 
                    '<h3>' + 
                      'Chapter ' + chapterHSCode + ' - ' + chapter.description +
                    '</h3>' + 
                    '<ul>' + 
                    Object.keys(hierarchy)
                      .filter(filterType('heading'))
                      .filter(filterHS(chapterHSCode))
                      .sort()
                      .map(headingToHTML)
                      .join('') +
                    '</ul>' + 
                  '</p>';
        }
        
        function sectionToHTML(sectionHSCode)
        {
          var section = hierarchy[sectionHSCode];
          return '<p>' + 
                    '<h2>' + 
                      'Section ' + sectionHSCode + ' - ' + section.description +
                    '</h2>' + 
                    Object.keys(hierarchy)
                      .filter(filterType('chapter'))
                      .filter(filterChapter(section.chapterStart, section.chapterEnd))
                      .sort()
                      .map(chapterToHTML)
                      .join('') +
                  '</p>';
        }
        
        
        // display hierarchy
        $('#hierarchy').html(Object.keys(hierarchy)
          .filter(filterType('section'))
          .map(sectionToHTML)
          .join(''));

        $('#hierarchy').show();
        $('#loading').hide();
      });
    </script>
  </div>
  
  <div id="footer"></div>
  
</body>
</html>
